{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% block content %}
<!-- Header-->
<br><br>

<!-- Slider Section -->
<style>
    .carousel-item {
        opacity: 0;
        transition: opacity 1s ease-in-out;
    }
    .carousel-item.active {
        opacity: 1;
    }
</style>

<!-- Story Style -->
<style>
    .stories-container {
  display: flex;
  background: #fff;
  box-shadow: 0 3px 24px -8px rgba(0, 0, 0, 0.3);
  width: 640px;
  margin: 0 auto;
  padding: 20px 36px;
  border-radius: 8px;
  gap: 48px;
  overflow: hidden;
  overflow-x: scroll;
  box-sizing: border-box;
}

.stories-container .content img {
  height: 90px;
  width: 90px;
  border-radius: 50%;
  object-fit: cover;
  z-index: 300;
  position: relative;
  vertical-align: middle;
}

.stories-container .content {
  position: relative;
  cursor: pointer;
}

.stories-container .content::before {
  content: "";
  height: 98px;
  width: 98px;
  background: #fff;
  border-radius: 50%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 101;
}

.stories-container .content::after {
  content: "";
  height: 106px;
  width: 106px;
  background: linear-gradient(#dd2a7b, #f58529);
  border-radius: 50%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 100;
}

.story-full {
  background: #222;
  position: fixed;
  left: 0;
  top: 0;
  height: 100vh;
  width: 100%;
  z-index: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: all 100ms ease;
}

.story-full.active {
  opacity: 1;
  pointer-events: auto;
}

.story-full .close-btn {
  position: fixed;
  right: 32px;
  top: 32px;
  width: 32px;
  cursor: pointer;
}

.story-full .content .left-arrow,
.story-full .content .right-arrow {
  width: 60px;
  cursor: pointer;
}

.story-full .content {
  height: 100%;
  display: flex;
  align-items: center;
  position: relative;
}

.story-full img {
  height: 90%;
}

.story-full .content .title {
  position: absolute;
  bottom: 26px;
  left: 50%;
  transform: translateX(-50%);
  background: #fff;
  font-family: "Roboto", sans-serif;
  line-height: 2;
  padding: 8px 32px;
}

@media (max-width: 700px) {
  .stories-container {
    width: 90%;
  }

  .stories-container .content img {
    width: 60px;
    height: 60px;
  }

  .stories-container .content::before {
    height: 70px;
    width: 70px;
  }

  .stories-container .content::after {
    width: 80px;
    height: 80px;
  }

  .story-full .content img {
    height: 65%;
  }
}
</style>

<!-- Story Section -->
<div class="stories-container">

    </div>

    <div class="story-full">
      <div class="content">
        <div class="close-btn">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="#fff"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </div>

        <div class="left-arrow">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="#fff"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </div>

        <img src="{% static 'assets/1.png' %}" alt="" />

        <div class="right-arrow">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="#fff"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 5l7 7-7 7"
            />
          </svg>
        </div>

        <div class="title">Test Title</div>
      </div>
    </div>
<!-- Slider Section -->
<div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="{% static 'assets/slide1.webp' %}" class="d-block w-100" alt="Slide 1">
        </div>
        <div class="carousel-item" >
            <img src="{% static 'assets/slide2.gif' %}" class="d-block w-100" alt="Slide 2">
        </div>
        <div class="carousel-item">
            <img src="{% static 'assets/slide3.gif' %}" class="d-block w-100" alt="Slide 3">
        </div>
        <div class="carousel-item">
            <img src="{% static 'assets/slide4.webp' %}" class="d-block w-100" alt="Slide 4">
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel"
        data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="{% static 'js/scripts.js' %}"></script>
    <script>
    const allStories = [
  {
    thumbUrl: "{% static 'assets/1-thumb.png' %}",
    imageUrl: "{% static 'assets/1.png' %}",
    title: "Title No. 1",
  },

  {
    thumbUrl: "{% static 'assets/2-thumb.png' %}",
    imageUrl: "{% static 'assets/2.png' %}",
    title: "Title No. 2",
  },

  {
    thumbUrl: "{% static 'assets/3-thumb.png' %}",
    imageUrl: "{% static 'assets/3.png' %}",
    title: "Title No. 3",
  },

  {
    thumbUrl: "{% static 'assets/4-thumb.png' %}",
    imageUrl: "{% static 'assets/4.png' %}",
    title: "Title No. 4",
  },

  {
    thumbUrl: "{% static 'assets/5-thumb.png' %}",
    imageUrl: "{% static 'assets/5.png' %}",
    title: "Title No. 5",
  },

  {
    thumbUrl: "{% static 'assets/6-thumb.png' %}",
    imageUrl: "{% static 'assets/6.png' %}",
    title: "Title No. 6",
  },

  {
    thumbUrl: "{% static 'assets/7-thumb.png' %}",
    imageUrl: "{% static 'assets/7.png' %}",
    title: "Title No. 7",
  },

  {
    thumbUrl: "{% static 'assets/8-thumb.png' %}",
    imageUrl: "{% static 'assets/8.png' %}",
    title: "Title No. 8",
  },
];

const storiesContainer = document.querySelector(".stories-container");
const storyFull = document.querySelector(".story-full");
const storyFullImage = document.querySelector(".story-full img");
const storyFullTitle = document.querySelector(".story-full .title");
const closeBtn = document.querySelector(".story-full .close-btn");
const leftArrow = document.querySelector(".story-full .left-arrow");
const rightArrow = document.querySelector(".story-full .right-arrow");

let currentIndex = 0;
let timer;

allStories.forEach((s, i) => {
  const content = document.createElement("div");
  content.classList.add("content");

  const img = document.createElement("img");
  img.setAttribute("src", s.thumbUrl);

  storiesContainer.appendChild(content);
  content.appendChild(img);

  content.addEventListener("click", () => {
    currentIndex = i;
    storyFull.classList.add("active");
    storyFullImage.setAttribute("src", s.imageUrl);

    if (!s.title) {
      storyFullTitle.style.display = "none";
    } else {
      storyFullTitle.style.display = "block";
      storyFullTitle.innerHTML = s.title;
    }

    clearInterval(timer);
    timer = setInterval(nextStory, 5000);
  });
});

closeBtn.addEventListener("click", () => {
  storyFull.classList.remove("active");
});

leftArrow.addEventListener("click", () => {
  if (currentIndex > 0) {
    currentIndex -= 1;

    storyFullImage.setAttribute("src", allStories[currentIndex].imageUrl);

    if (!allStories[currentIndex].title) {
      storyFullTitle.style.display = "none";
    } else {
      storyFullTitle.style.display = "block";
      storyFullTitle.innerHTML = allStories[currentIndex].title;
    }

    clearInterval(timer);
    timer = setInterval(nextStory, 5000);
  }
});

const nextStory = () => {
  if (currentIndex < allStories.length - 1) {
    currentIndex += 1;

    storyFullImage.setAttribute("src", allStories[currentIndex].imageUrl);

    if (!allStories[currentIndex].title) {
      storyFullTitle.style.display = "none";
    } else {
      storyFullTitle.style.display = "block";
      storyFullTitle.innerHTML = allStories[currentIndex].title;
    }
  }
};

rightArrow.addEventListener("click", () => {
  nextStory();
  clearInterval(timer);
  timer = setInterval(nextStory, 5000);
})
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var carouselItems = document.querySelectorAll('.carousel-item');
            carouselItems.forEach(function(item) {
                var img = item.querySelector('img');
                img.onload = function() {
                    item.style.opacity = '1';
                };
            });

            var myCarousel = document.querySelector('#productCarousel');
            var carousel = new bootstrap.Carousel(myCarousel, {
                interval: 2000,
                wrap: true
            });
        });
    </script>

<!-- Section-->
<section class="py-5">
    <div class="container px-4 px-lg-5 mt-5">
        <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
            {% for item in products %}
            {% if item.is_sale %}
            <div class="col mb-5">
                <div class="card h-100">
                    <div class="badge bg-dark text-white position-absolute" style="top: 0.5rem; right: 0.5rem">تخفیف ویژه</div>
                    <!-- Product image-->
                    <img class="card-img-top" src="{{ item.picture.url }}" alt="..." />
                    <!-- Product details-->
                    <div class="card-body p-4">
                        <div class="text-center">
                            <!-- Product name-->
                            <h5 class="fw-bolder">{{ item.name }}</h5>
                            <div class="d-flex justify-content-center small text-warning mb-2">
                                {% with ''|center:item.star as range %}
                                {% for _ in range %}
                                <div class="bi-star-fill"></div>
                                {% endfor %}
                                {% endwith %}
                            </div>
                            <!-- Product price-->
                            <strike>{{ item.price | intcomma }} تومان </strike> <br>
                            {{ item.sale_price | intcomma }} تومان
                        </div>
                    </div>
                    <!-- Product actions-->
                    <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                        <div class="text-center"><a class="btn btn-outline-dark mt-auto" href="{% url 'product' item.id %}">صفحه محصول</a></div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col mb-5">
                <div class="card h-100">

                    <!-- Product image-->
                    <img class="card-img-top" src="{{ item.picture.url }}" alt="..." />
                    <!-- Product details-->
                    <div class="card-body p-4">
                        <div class="text-center">
                            <!-- Product name-->
                            <h5 class="fw-bolder">{{ item.name }}</h5>
                            <div class="d-flex justify-content-center small text-warning mb-2">
                                {% with ''|center:item.star as range %}
                                {% for _ in range %}
                                <div class="bi-star-fill"></div>
                                {% endfor %}
                                {% endwith %}
                            </div>

                            <!-- Product price-->
                            {{ item.price | intcomma }} تومان
                        </div>
                    </div>
                    <!-- Product actions-->
                    <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                        <div class="text-center"><a class="btn btn-outline-dark mt-auto" href="{% url 'product' item.id %}">صفحه محصول</a></div>
                    </div>
                </div>
            </div>

            {% endif %}
            {% endfor %}
                    
        </div>
    </div>

</section>


{% endblock %}


